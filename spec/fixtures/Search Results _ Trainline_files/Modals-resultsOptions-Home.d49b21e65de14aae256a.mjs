"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[64164],{98238:(e,t,s)=>{s.d(t,{ZP:()=>hs});var a=s(64321),r=s(31105),n=s(29901),i=s(88543),o=s(23198),l=s(98184),c=s(2031),d=s(18406),u=s(595),p=s(26625),h=s(82758),m=s(55373),g=s(61730),v=s(85924),E=s(50093),y=s(84025),f=s.n(y),S=s(57397),b=s(89426),C=s(55640),P=s(28770),Z=s(41966),R=s(60654),D=s(77009),k=s(62555),T=s(31616),F=s(74387),I=s(78307),L=s(235),x=s(77962),O=s(21847),A=s(18665),M=s(69970),N=s(99112),w=s(61065),V=s(74999),j=s(98318),_=s(8888),U=s(23394),B=s(94878),W=s(4385),Y="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px ".concat((0,B.I)(W.ZP.dp_brand_primary_core,.6));const z=E.StyleSheet.create({root:{position:"relative"},textInputWrapper:{backgroundColor:j.dp_comp_input_binary_background_base,borderRadius:U.E0.m,position:"relative"},textInputWrapperDisabled:{backgroundColor:j.dp_app_backdrop_dull,opacity:.5},textInput:{backgroundColor:"transparent",lineHeight:"var(--DEPRECATED-18px)",paddingLeft:_.Z.sizes.spacers.s,paddingRight:_.Z.sizes.spacers.xl,position:"relative",":focus":{outline:"none",padding:_.Z.sizes.spacers.s,paddingRight:"calc(".concat(_.Z.sizes.spacers.xl," - 1px)"),borderColor:j.dp_brand_primary_mid,borderWidth:1,boxShadow:Y}},hasTitle:{padding:"".concat(_.Z.sizes.spacers.px30," ").concat(_.Z.sizes.spacers.xl," ").concat(_.Z.sizes.spacers.s," ").concat(_.Z.sizes.spacers.px12),":focus":{padding:"".concat(_.Z.sizes.spacers.px30," calc(").concat(_.Z.sizes.spacers.xl," - 1px) ").concat(_.Z.sizes.spacers.s," ").concat(_.Z.sizes.spacers.px12)}},chevronWrapper:{alignItems:"center",bottom:0,display:"flex",position:"absolute",right:_.Z.sizes.spacers.s,top:0},chevron:{stroke:j.dp_brand_neutral_dullest,width:"var(--DEPRECATED-14px)"},dropdownContainer:{overflow:"visible"},calendar:{display:"flex",flexDirection:"row",flexWrap:"nowrap",width:"var(--DEPRECATED-560px)"},inputTitle:{position:"absolute",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",left:_.Z.sizes.spacers.px12,top:_.Z.sizes.spacers.xs,right:_.Z.sizes.spacers.px30}});var K=s(20634),q="DD-MMM-YY",G=["Enter"," "];class H extends n.Component{constructor(e){var t;super(e),t=this,(0,v.Z)(this,"input",void 0),(0,v.Z)(this,"containerRef",(0,n.createRef)()),(0,v.Z)(this,"inputFocused",(()=>this.input&&this.input===document.activeElement)),(0,v.Z)(this,"isFocusInsideContainer",(()=>{var e;return null===(e=this.containerRef.current)||void 0===e?void 0:e.contains(document.activeElement)})),(0,v.Z)(this,"focusOnForceShow",(()=>{this.props.forceShowCalendar&&this.state.showCalendar&&this.input&&!this.isFocusInsideContainer()&&!this.inputFocused()&&this.input.focus()})),(0,v.Z)(this,"saveInput",(e=>this.input=e)),(0,v.Z)(this,"onDismiss",(()=>{this.inputFocused()&&!this.props.clickOnly||(this.resetState(),this.props.onDismissCallback&&this.props.onDismissCallback())})),(0,v.Z)(this,"getPreferredPositions",(e=>e.indexOf(M.q$.START_END)>-1?M.q$.START_END:e.indexOf(M.q$.END_END)>-1?M.q$.END_END:M.q$.CENTER_END)),(0,v.Z)(this,"formatValueForInput",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.Z;return t.props.value?f()(t.props.value).locale(s).format(q):e})),(0,v.Z)(this,"getDefaultCurrentMonth",(e=>{var t=f()(e||this.props.value),s=f()(this.props.startDate),a=f()(this.props.endDate);return(!t.isValid()||t.isBefore(s)||t.isAfter(a)?s:t).startOf("month").toISOString()})),(0,v.Z)(this,"resetState",(()=>{this.setState({showCalendar:!1,currentMonth:this.getDefaultCurrentMonth()})})),(0,v.Z)(this,"getInputValue",(()=>{var e=this.formatValueForInput("",this.props.locale);return"undefined"!=typeof document&&this.inputFocused()?this.state.isFocusing&&e?e:this.state.currentInputValue||"":e})),(0,v.Z)(this,"onFocus",(e=>{this.setState({isFocusing:!0}),this.props.onFocus&&this.props.onFocus(e),this.setState({isRefocusing:!1})})),(0,v.Z)(this,"toggleCalendar",(()=>{this.setState((e=>{var{showCalendar:t}=e;return{showCalendar:!t}}))})),(0,v.Z)(this,"onClick",(()=>{this.state.preventClick||this.toggleCalendar(),this.setState({preventClick:!1})})),(0,v.Z)(this,"onBlur",(()=>{this.setState((e=>{var{currentInputValue:t}=e;return{isFocusing:!1,currentInputValue:this.formatValueForInput(t)}}))})),(0,v.Z)(this,"onChange",(e=>{this.setState({isFocusing:!1});var t=e.target.value;this.setInputValue(t)})),(0,v.Z)(this,"setInputValue",(e=>{var t=f()(e,["DD/MM/YY","DD-MMM-YY","DD-MM-YY"]).startOf("day"),s=t.isValid()&&t.format("YYYY-MM-DD"),a=f()(this.props.value).format("YYYY-MM-DD");e.length>=5&&s&&s!==a&&(this.onChangeCurrentMonth(s),this.props.onChange(s)),this.inputFocused()&&this.setState({currentInputValue:e})})),(0,v.Z)(this,"onKeydown",(e=>{this.state.showCalendar&&"Escape"===e.key&&this.resetState(),-1!==G.indexOf(e.key)&&(this.toggleCalendar(),e.preventDefault())})),(0,v.Z)(this,"onCalendarSelect",(e=>{this.setState({currentInputValue:f()(e).format(q)}),this.onChangeCurrentMonth(e),this.props.onChange(e),this.input&&(this.setState({isRefocusing:!0}),this.input.focus()),this.setState({preventClick:!1,showCalendar:!1})})),(0,v.Z)(this,"onChangeCurrentMonth",(e=>{var t=this.getDefaultCurrentMonth(e);this.setState((e=>{var{currentMonth:s}=e;return t!==s?{currentMonth:t}:null}))})),this.state={isFocusing:!1,preventClick:!1,isRefocusing:!1,showCalendar:!1,currentMonth:this.getDefaultCurrentMonth(),currentInputValue:this.formatValueForInput()}}componentDidMount(){this.input&&this.input.value!==this.props.value&&this.setInputValue(this.input.value),this.focusOnForceShow()}componentDidUpdate(e){this.focusOnForceShow();var{locale:t,forceShowCalendar:s,value:a}=this.props,r=t!==e.locale;s&&!e.forceShowCalendar&&this.setState({showCalendar:!0}),(r||a!==e.value)&&this.setState({currentMonth:this.getDefaultCurrentMonth(this.props.value)})}render(){var{name:e,locale:t,value:s,startDate:a,endDate:r,disabled:i=!1,styleSheet:o={},intl:c,clickOnly:d=!1,inputTitle:u}=this.props;return n.createElement("div",{className:(0,E.css)(z.root),onKeyDown:this.onKeydown,"data-test":"date-picker",ref:this.containerRef},n.createElement("div",{className:(0,E.css)(z.textInputWrapper,o.inputWrapper,i&&z.textInputWrapperDisabled),"data-test":"date-picker-input-wrapper"},n.createElement("div",{className:(0,E.css)(z.chevronWrapper,o.chevronWrapper)},n.createElement(Z.Z,{className:(0,E.css)(z.chevron)})),u&&n.createElement("div",{className:(0,E.css)(z.inputTitle,o.inputTitle)},n.createElement(l.FormattedMessage,{id:u})),n.createElement(V.Z,{ariaLabel:c&&c.formatMessage({id:"components.datePicker.date.aria"},{dateValue:this.getInputValue()}),inputRef:this.saveInput,name:e,testId:"date-input-field",value:this.getInputValue(),maxLength:35,onChange:this.onChange,onFocus:this.onFocus,styleSheet:[z.textInput,u&&z.hasTitle,o.textInput],onBlur:this.onBlur,disabled:i,readOnly:d,onClick:this.onClick})),this.state.showCalendar&&n.createElement(N.Z,{onDismiss:this.onDismiss},n.createElement(M.ZP,{element:this.input,anchorPosition:this.getPreferredPositions},n.createElement(w.Z,{styleSheet:z.dropdownContainer},n.createElement(K.Z,{name:e,locale:t,wrapperStyles:[z.calendar],selectedDate:s,minDate:a,maxDate:r,onSelect:this.onCalendarSelect,onChangeMonth:this.onChangeCurrentMonth,currentMonth:this.state.currentMonth,trimBeyondMaxDate:!0,disabled:i})))))}}const Q=(0,l.injectIntl)(H);var J=s(18212),$=s(56136),X=s(18952),ee=s(74981),te=s(57223),se=s(5193);class ae extends n.PureComponent{constructor(){super(...arguments),(0,v.Z)(this,"inputRefs",{}),(0,v.Z)(this,"state",{forceShowCalendar:!1,initialValue:null}),(0,v.Z)(this,"onDatePickerDismiss",(()=>{this.setState({forceShowCalendar:!1})})),(0,v.Z)(this,"setInitialValue",(e=>this.setState({initialValue:e}))),(0,v.Z)(this,"resetToInitialValue",(()=>this.props.onChange(this.state.initialValue))),(0,v.Z)(this,"handleSameDayNextDayClick",(e=>{var{isOutbound:t,onChange:s,value:a}=this.props,r=(0,x.uy)(t,!1),n=f()(this.props.startDateTime);n.isSame(f()(this.props.startDateTime).startOf("day"))||n.add(e,"days"),e>0&&(a&&""!==a.hours&&""!==a.minutes?n.hours(+a.hours).minutes(+a.minutes):n.isAfter(r,"day")&&n.hours(se.dS).minutes(se.eu));var i=n.isBefore(r)?r:n;this.props.onNextOrSameDayClick&&this.props.onNextOrSameDayClick(i.format()),s({date:i.clone().startOf("day").format(),hours:(0,se.iB)(i.hours()),minutes:(0,se.iB)(i.minutes()),dateType:a&&a.dateType})})),(0,v.Z)(this,"handleSameDayClick",(()=>{this.handleSameDayNextDayClick(0)})),(0,v.Z)(this,"handleNextDayClick",(()=>{this.handleSameDayNextDayClick(1)})),(0,v.Z)(this,"onDatePickerFocus",(()=>{var e,{isOutbound:t,startDateTime:s,value:a,onChange:r}=this.props;if(a&&a.date&&a.hours&&a.minutes){var n=(0,x.uy)(t,!1),i=f()(s),o=f()(a.date).hours(parseInt(a.hours,10)).minutes(parseInt(a.minutes,10)),l=n.isAfter(i)?n:i;o.isBefore(l)&&(e=(0,x.ym)(l,a.dateType))}void 0!==e&&r(e)})),(0,v.Z)(this,"generateOnChange",(e=>t=>{var{isOutbound:s,value:a,onChange:r}=this.props,n=a&&a.date?a:(0,se.t4)(s);if("date"===e){var i=(0,x.uy)(s,!1);f()(t).isAfter(i,"day")&&a&&""===a.hours&&""===a.minutes&&(n.hours=(0,se.iB)(se.dS),n.minutes=(0,se.iB)(se.eu))}r((0,o.Z)((0,o.Z)({},n),{},{[e]:t}))})),(0,v.Z)(this,"generateChangeEventHandler",(e=>t=>{this.generateOnChange(e)(t.currentTarget.value)})),(0,v.Z)(this,"saveInputRefs",(e=>t=>this.inputRefs[e]=t))}componentDidMount(){var e=!1,{isOutbound:t,value:s}=this.props;if(t&&s){this.setInitialValue(s);var a=(0,x.aD)(s),r=(0,x.uy)(!0,!1);a.isBefore(r)&&this.setNewMinTime(this.props);var n="hours",i="minutes",l=this.inputRefs[n]&&this.inputRefs[n].value,c=this.inputRefs[i]&&this.inputRefs[i].value;if(l&&c){var d="".concat(l,":").concat(c);f()(d,"HH:mm").isBefore(r)&&(this.props.onChange((0,o.Z)({},s)),this.setInitialValue((0,o.Z)({},s)),e=!0)}}if(!e){var u=!1,p=Object.keys(this.inputRefs).reduce(((e,t)=>(this.inputRefs[t]&&this.props.value&&this.props.value[t]&&this.inputRefs[t].value!==this.props.value[t]&&(u=!0,e[t]=this.inputRefs[t].value),e)),{});if(u){var h=(0,o.Z)((0,o.Z)({},s),p);this.props.onChange(h),this.setInitialValue(h)}}}componentDidUpdate(e){var{error:t}=this.props,s=t!==e.error,a=s&&t===L.ZA.inbound.empty;s&&a!==this.state.forceShowCalendar&&this.setState({forceShowCalendar:a}),this.props.forceNewMinTime&&this.setNewMinTime(this.props,!0)}setNewMinTime(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{onChange:s,value:a,isOutbound:r}=this.props,n=(0,x.uy)(r,t);if(!e.isOutbound){var i=f()(e.startDateTime);i.isAfter(n)&&(n=i)}a&&""!==a.hours&&s({date:n.clone().startOf("day").format(),hours:(0,se.iB)(n.hours()),minutes:(0,se.iB)(n.minutes()),dateType:a&&a.dateType})}render(){var{isOutbound:e,locale:t,value:s,title:r,sameDayLabel:i,nextDayLabel:o,sameDayAriaLabel:c,nextDayAriaLabel:d,beforeLabel:u,afterLabel:h,startDateTime:m,error:g,onDisabledClick:v,testId:y,isMobileDevice:f,hasEuropeExperience:S,journeySearchType:C,intl:P}=this.props,Z=!e&&C!==I.ki.RETURN,R=Z?[te.ZP.dayButton,te.ZP.dayButtonDisabled]:[te.ZP.dayButton],D=g===L.ZA.inbound.empty,k={isSearchWidget:!1,hasEuropeExperience:S,disabled:Z,beforeLabel:u,afterLabel:h,value:s,onChange:this.generateChangeEventHandler("dateType"),inputRef:this.saveInputRefs("dateType"),styleSheet:(0,$.y)(te.sK,!D&&g&&te.SO)};return n.createElement("fieldset",{className:(0,E.css)(te.ZP.dateTimePickerWrapper),"data-test":y},n.createElement("legend",{className:(0,E.css)(te.ZP.dateTimePickerHeader)},n.createElement(l.FormattedMessage,{id:r})),n.createElement("div",{className:(0,E.css)(te.ZP.dayButtonsContainer)},n.createElement(b.ZP,{testId:"datepicker-same-day-button",styleSheet:R,onClick:this.handleSameDayClick,disabled:Z,tabIndex:Z?-1:0,ariaLabel:c&&P.formatMessage({id:c})},n.createElement(l.FormattedMessage,{id:i})),n.createElement(b.ZP,{testId:"datepicker-next-day-button",styleSheet:R,onClick:this.handleNextDayClick,disabled:Z,tabIndex:Z?-1:0,ariaLabel:d&&P.formatMessage({id:d})},n.createElement(l.FormattedMessage,{id:o}))),n.createElement(Q,{id:"journey-search-form-date-picker",locale:t,name:r,value:s&&s.date,onFocus:this.onDatePickerFocus,onChange:this.generateOnChange("date"),startDate:m,endDate:(0,x.v3)(S),disabled:Z,styleSheet:!D&&g?te.r4:void 0,forceShowCalendar:this.state.forceShowCalendar,onDismissCallback:this.onDatePickerDismiss,clickOnly:f}),n.createElement("div",{className:(0,E.css)(te.ZP.beforeAfterWrapper)},n.createElement(X.Z,(0,a.Z)({},k,{afterLabelStyle:te.ZP.afterLabel}))),n.createElement("div",{className:(0,E.css)(te.ZP.timePickerWrapper)},[se.J6.HOURS,se.J6.MINUTES].map(((e,t)=>n.createElement(ee.Z,{key:t,name:e,styleSheet:(0,$.y)(te.pq,!D&&g&&te.SO),items:se.pN[e],value:s,onChange:this.generateChangeEventHandler(e),inputRef:this.saveInputRefs(e),disabled:Z,id:"journey-search-form-time-picker"})))),g&&!D&&n.createElement("div",{className:(0,E.css)(te.ZP.errorWrapper)},n.createElement(J.Z,{level:"error",connector:J.w.TOP_LEFT,dark:!0,bounceIn:!0,testId:"date-in-past-error-message"},n.createElement(p.fQ,{hooks:[p.OS.ON_RENDER],event:(0,p.C6)({format:"inline.validation.error",message:P.formatMessage({id:g}),id:g,type:O.ErrorType.Customer})},n.createElement(l.FormattedMessage,{id:g})))),Z&&v&&n.createElement("div",{className:(0,E.css)(te.ZP.disabledCover),onClick:()=>{this.setState({forceShowCalendar:!0}),v()}}))}}const re=(0,l.injectIntl)(ae);var ne=["input","meta","journeySearchType","inboundOutboundError"];const ie=e=>{var{input:t,meta:s,journeySearchType:a,inboundOutboundError:r}=e,i=(0,T.Z)(e,ne),{name:l,value:c,onChange:d}=t,u="outbound"===l,p=void 0!==typeof c&&(0,x.aD)(c).isBefore((0,x.uy)(u,i.isSubmitting)),h=a===I.ki.RETURN,m=Boolean(!h&&i.isSubmitting&&u&&p),g=s.error===L.ZA.inbound.empty,v=i.isSubmitting&&g||i.disabled?"":s.error,E=(0,o.Z)((0,o.Z)({},i),{},{value:c,error:v,forceNewMinTime:m,journeySearchType:a,inboundOutboundError:r,isOutbound:u,onChange:d});return n.createElement(F.Z,{name:l},n.createElement(re,E))};var oe=s(79076),le=s(61829),ce=s(93902),de=s(71695),ue=s(52068);const pe=E.StyleSheet.create({root:{background:(0,B.I)(W.ZP.dp_brand_white,.12),borderRadius:U.E0.m,display:"flex",justifyContent:"center",margin:"".concat(_.Z.sizes.spacers.xs," 0"),padding:"".concat(_.Z.sizes.spacers.xs," ").concat(_.Z.sizes.spacers.s),width:"100%",textAlign:"center"},legend:{border:0,clip:"rect(0, 0, 0, 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",width:1},europeExperience:{justifyContent:"center"}});var he=(0,o.Z)((0,o.Z)({},ue.W.small),{},{color:j.dp_app_text_inverted,marginLeft:_.Z.sizes.spacers.l,flexBasis:"0px",flexGrow:1,":first-of-type":{margin:0}}),me=E.StyleSheet.create({root:(0,o.Z)((0,o.Z)({},he),{},{flexDirection:"column"}),input:{margin:_.Z.sizes.spacers.px5},childrenTabs:{maxWidth:"100%"}}),ge=E.StyleSheet.create({root:(0,o.Z)((0,o.Z)({},he),{},{flexDirection:"column"}),input:{":focus":{outline:"none",borderRadius:"50%",boxShadow:"0 0 0 0.141rem ".concat(j.dp_brand_primary_mid)},margin:_.Z.sizes.spacers.px5},childrenTabs:{maxWidth:"100%"}});class ve extends n.Component{constructor(){super(...arguments),(0,v.Z)(this,"state",{tabbedIn:!1}),(0,v.Z)(this,"inputRefs",[]),(0,v.Z)(this,"onChange",(e=>{var{input:t,isOpenReturnChangesForMWebEnabled:s,change:a}=this.props,{onChange:r}=t;r(e),s&&a&&(e.currentTarget.value===I.ki.OPEN_RETURN?a("openReturnType",I.xj.ONE_MONTH):a("openReturnType",void 0))})),(0,v.Z)(this,"onClick",(()=>{this.setState({tabbedIn:!1})})),(0,v.Z)(this,"saveRadioInputRef",(e=>this.inputRefs.push(e))),(0,v.Z)(this,"focus",(()=>{this.inputRefs.forEach((e=>{e&&e.checked&&(e.focus(),this.setState({tabbedIn:!0}))}))})),(0,v.Z)(this,"getSelected",(()=>this.inputRefs.filter((e=>e&&e.checked)).map((e=>e.value))[0]))}componentDidMount(){var{input:e,saveRef:t}=this.props,s=this.getSelected();void 0!==s&&e.value!==s&&e.onChange(s),t&&t(this)}componentDidUpdate(e){var{input:t}=this.props,s=this.getSelected();this.props.hasEuropeExperience&&this.props.hasEuropeExperience!==e.hasEuropeExperience&&"openReturn"===s&&t.onChange("single");var{saveRef:a}=this.props;a&&a(this)}render(){var{input:e,intl:t,hasEuropeExperience:s,isSearchResultsPage:a,enableSeasonsSearch:r}=this.props,{value:i}=e,o=this.state.tabbedIn?ge:me,c=r&&!s&&!a;return n.createElement("fieldset",null,n.createElement("div",{className:(0,E.css)(pe.root,s&&pe.europeExperience),"data-test":"journey-types",role:"radiogroup","aria-label":(0,de.wv)(t,"page.journeySearchForm.radioGroupLabel")},n.createElement("legend",{className:(0,E.css)(pe.legend)},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.legendFieldset"})),n.createElement(ce.Z,{styleSheet:o,name:"journeyType",id:"single",value:"single",checked:"single"===i,onClick:this.onClick,onChange:this.onChange,inputRef:this.saveRadioInputRef,testId:"single-journey-radio-button"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.oneWayLabel"})),n.createElement(ce.Z,{styleSheet:o,name:"journeyType",id:"return",value:"return",checked:"return"===i,inputRef:this.saveRadioInputRef,onClick:this.onClick,onChange:this.onChange,testId:"return-journey-radio-button"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.returnLabel"})),!s&&n.createElement(ce.Z,{styleSheet:o,name:"journeyType",id:"openReturn",value:"openReturn",checked:"openReturn"===i,inputRef:this.saveRadioInputRef,onClick:this.onClick,onChange:this.onChange,testId:"open-return-journey-radio-button"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.openReturnLabel"})),c&&n.createElement(ce.Z,{styleSheet:o,name:"journeyType",id:"seasons",value:"seasons",checked:"seasons"===i,inputRef:this.saveRadioInputRef,onClick:this.onClick,onChange:this.onChange,testId:"season-search-radio-button"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.seasonTickets.seasons"}))))}}const Ee=(0,l.injectIntl)(ve);var ye=s(90878),fe=s(39832),Se=s(48216),be=s(73590),Ce=s(83661),Pe=s(13779),Ze=s(49407),Re=s(24955),De=s(3963),ke=(e,t)=>{var{from:s,to:a}=t;return e&&s&&s.countryCode&&s.countryCode.toLowerCase()===e.toLowerCase()&&a&&a.countryCode&&a.countryCode.toLowerCase()===e.toLowerCase()},Te={FRANCE:de.Qd.FRANCE,GERMANY:de.Qd.GERMANY,SPAIN:de.Qd.SPAIN,ITALY:de.Qd.ITALY,EUROSTAR:"EUROSTAR"},Fe=[de.Qd.FRANCE,de.Qd.NETHERLANDS,de.Qd.BELGIUM].map((e=>e.toLowerCase())),Ie=["urn:trainline:generic:loc:182gb","urn:trainline:generic:loc:8267","urn:trainline:generic:loc:stp1555gb","urn:trainline:generic:loc:ebd5566gb","urn:trainline:generic:loc:afk5004gb"].map((e=>e.toLowerCase())),Le=e=>ke(de.Qd.FRANCE,e)?Te.FRANCE:ke(de.Qd.GERMANY,e)?Te.GERMANY:ke(de.Qd.SPAIN,e)?Te.SPAIN:ke(de.Qd.ITALY,e)?Te.ITALY:(e=>{var{from:t,to:s}=e;if(!t||!s)return!1;var a=[t,s];return a.some((e=>Boolean(e.code)&&Ie.includes(e.code.toLowerCase())))&&a.some((e=>Boolean(e.countryCode)&&Fe.includes(e.countryCode.toLowerCase())))})(e)?Te.EUROSTAR:void 0,xe=s(70363),Oe=e=>{var{railcards:t,vouchers:s=0,from:a,to:r,locale:n,passengersWithPRM:i=0}=e;if(i>0)return{id:"page.journeySearchForm.eupassengerPicker.wheelchairsRailcardsAndVouchers",values:{passengersWithPRM:i,railcards:t,vouchers:s}};if(t>0||s>0)return{id:"page.journeySearchForm.eupassengerPicker.railcardsAndVouchers",values:{railcards:t,vouchers:s}};var o=Le({from:a,to:r});return o===Te.ITALY?{id:"page.journeySearchForm.passengerPicker.addCartaFRECCIARailcard"}:o===Te.SPAIN&&(e=>[de.vi.FRENCH,de.vi.GERMAN,de.vi.SPANISH].includes(e))(n)?{id:"page.journeySearchForm.eupassengerPicker.addRenfeRailcard"}:o===Te.GERMANY?{id:"page.journeySearchForm.passengerPicker.addBahnRailcard"}:o===Te.FRANCE?{id:"page.journeySearchForm.passengerPicker.addSncfRailcard"}:o===Te.EUROSTAR?{id:"page.journeySearchForm.passengerPicker.addEuroStarRailcard"}:{id:"page.journeySearchForm.eupassengerPicker.noRailcardsAndVouchers"}};const Ae=e=>{var{isEuropeExperience:t}=e,s=t?Oe(e):(e=>{var{railcards:t,vouchers:s,enableUkVouchers:a,promoCode:r}=e;return{id:a?"page.journeySearchForm.passengerPicker.railcards.promo":"page.journeySearchForm.passengerPicker.railcards",values:{railcards:t,vouchers:s,promoCode:r}}})(e);return n.createElement("div",{className:(0,E.css)(xe.Z.horizontalSearchRailcards)},n.createElement(l.FormattedMessage,s))};var Me=s(42018),Ne=s(48064),we=s(15378),Ve=s(96391),je=s(8074),_e=s(66593),Ue=s(49661),Be=s(69576),We=s(4582),Ye=s(42874),ze=()=>n.createElement("div",{className:(0,E.css)(Ue.ZP.headingContainer)},n.createElement("h3",{className:(0,E.css)(Ue.ZP.heading)},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.eupassengerPicker.heading.passengers"}))),Ke="page.journeySearchForm.passengers.error.none";class qe extends n.Component{constructor(){super(...arguments),(0,v.Z)(this,"picker",void 0),(0,v.Z)(this,"buttonDone",void 0)}getRefElement(e){this.picker=e}getButtonDoneElement(e){this.buttonDone=e}render(){var e,{prmEnabled:t,passengers:s,errors:a,launchPRMDetailsModal:r,launchDiscountCardModal:i,removeInvalidDiscountCards:o,toggleDiscountCardEnabled:c,availableCardTypes:d,isGuest:u,isRecognisedUser:m,intl:g,voucherCount:v,onRequestOpenPassengerProfileModal:y,onRequestOpenVoucherModal:f,locale:S,locations:C,from:P,to:R,uiState:D,pushEuFlowPassenger:k,onToggle:T,onDismiss:F,onLaunchPassengerList:L,onSignInPromptDismissed:x,discountCardsLoadStatus:A,isRailcardRecommendBannerEnabled:M}=this.props,V=s.filter(Re.On),j=(0,h.vY)(V.filter((e=>{var{name:t}=e;return!t})).map((e=>{var{type:t}=e;return t}))),_=V.reduce(((e,t)=>e+t.discountCards.filter((e=>d[e.id])).length),0),U=V.length,B=V.reduce(((e,t)=>{var{name:s}=t;return s&&e.push(s.split(" ")[0]),e}),[]),W=s.every((e=>{var{disability:t}=e;return t})),Y=s.filter((e=>{var{disability:t}=e;return Object.keys(t||{}).length>0})).length;e=0===U?Ue.ZP.errorButton:Ue.ZP.button;var z=(0,Ye.pN)({locations:C,isGuest:u,isRecognisedUser:m,originId:null==P?void 0:P.id,destinationId:null==R?void 0:R.id});return n.createElement("div",{ref:e=>this.getRefElement(e)},n.createElement(b.ZP,{id:"passenger-summary-btn",onClick:T,testId:"eu-passenger-summary-btn-open",styleSheet:e,ariaHaspopup:"dialog"},n.createElement("div",null,n.createElement(De.Z,{adults:j.adults,youths:j.youths,seniors:j.seniors,passengerNames:B,isEUSearch:!0,shouldUseItalianYouthAgeRange:z}),n.createElement(Ae,{railcards:_,vouchers:v,passengersWithPRM:Y,isEuropeExperience:!0,locale:S,locations:C,from:P,to:R}),n.createElement("div",{className:(0,E.css)(Ue.ZP.chevronWrapper)},n.createElement(Z.Z,{className:(0,E.css)(Ue.ZP.chevron),ariaHidden:!0})))),D.isOpen&&n.createElement(N.Z,{onDismiss:e=>F(e,this.picker,this.buttonDone)},n.createElement(Pe.Z,null,n.createElement(w.Z,{styleSheet:Ue.ZP.dropdownContainer,role:"dialog"},n.createElement(ze,null),(u||m&&(!D.searchValue||(0,Ne.px)(D.searchValue,s)))&&!D.promptDismissed&&n.createElement(Ve.Z,{onSignInPromptDismissed:x,enableDismissButton:!1,href:"".concat(Ze.wm,"?showRadioButtons=false"),isRecognisedUser:m}),M&&n.createElement(Me.Z,{passengers:s,slimVariant:!0}),0===U&&n.createElement(p.fQ,{hooks:[p.OS.ON_RENDER],event:(0,p.C6)({id:Ke,message:g.formatMessage({id:Ke}),format:"alert.warning",type:O.ErrorType.Customer})},n.createElement(Ce.WY,{styleSheet:Ue.ZP.maxPassengerAlertStyles},n.createElement(l.FormattedMessage,{id:Ke}))),n.createElement(be.Z,{name:"euFlowPassengers",component:Ne.ZP,prmEnabled:t,availableCardTypes:d,onRequestOpenPassengerProfileModal:y,errors:a,launchPRMDetailsModal:r,launchDiscountCardModal:i,removeInvalidDiscountCards:o,toggleDiscountCardEnabled:c,selectedPassengerCount:U,isGuest:u,isRecognisedUser:m,launchPassengerList:L,discountCardsLoadStatus:A,shouldUseItalianYouthAgeRange:z}),t&&n.createElement(we.ZP,{disabled:W,launchPRMDetailsModal:r}),n.createElement("div",{className:(0,E.css)(Ue.ZP.bottomWrapper)},U<I.wF&&(u?n.createElement(je.ZP,{onAddPassenger:k,launchPassengerList:L,intl:g,shouldUseItalianYouthAgeRange:z}):n.createElement(je.II,{onAddPassenger:()=>{var e=(0,Re.HL)();k(e),y(e.id)},launchPassengerList:L,intl:g})),n.createElement(Be.Z,{selectedPassengerCount:U}),n.createElement(_e.Z,{onRequestOpenVoucherModal:f,passengers:s,hasVoucher:!!v}),n.createElement(b.KM,{styleSheet:Ue.ZP.doneButton,onClick:e=>F(e,this.picker,this.buttonDone),saveInputRef:e=>this.getButtonDoneElement(e),testId:"eu-passenger-done-button"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.eupassengerPicker.doneButtonLabel"})))))))}}const Ge=(0,We.ZP)(qe);var{sizes:He}=_.Z;const Qe=E.StyleSheet.create({dateTimePickerWrapper:{color:j.dp_app_text_base,flex:1,position:"relative",marginTop:He.spacers.px50},inputWrapper:{backgroundColor:j.dp_app_backdrop_base,padding:0,border:"solid 1px ".concat(j.dp_app_border_dull),borderRadius:U.E0.m,":focus-within":{borderColor:j.dp_brand_primary_mid,borderWidth:1,boxShadow:"inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px ".concat((0,B.I)(W.ZP.dp_brand_primary_core,.6))},color:j.dp_app_text_base},textInput:{border:"none",":focus":{outline:"none",border:"none",boxShadow:"none"},fontWeight:"bold"},inputTitle:{},errorWrapper:ue.W.small});E.StyleSheet.create({textInput:{borderColor:j.dp_app_negative_mid,borderWidth:2,":focus":{borderColor:j.dp_app_negative_mid,borderWidth:2}}});class Je extends n.PureComponent{constructor(){super(...arguments),(0,v.Z)(this,"generateOnChange",(()=>e=>{var{onChange:t}=this.props;t({seasonsStartDate:e})}))}componentDidUpdate(){var{value:e,onChange:t}=this.props;e&&t(e)}render(){var{locale:e,value:t,startDateTime:s,isMobileDevice:a}=this.props;return n.createElement("fieldset",{className:(0,E.css)(Qe.dateTimePickerWrapper),"data-test":"season-date-picker"},n.createElement("div",null,n.createElement(Q,{id:"journey-search-form-seasons-date-picker",locale:e,name:"",value:t&&t.seasonsStartDate,onChange:this.generateOnChange(),startDate:s,endDate:(0,x.lZ)(s),styleSheet:Qe,clickOnly:a,inputTitle:"page.journeySearchForm.seasonTickets.startDate"})))}}const $e=(0,l.injectIntl)(Je);var Xe=["input","journeySearchType"];const et=e=>{var{input:t,journeySearchType:s}=e,a=(0,T.Z)(e,Xe),{name:r,value:i,onChange:l}=t,c=(0,o.Z)((0,o.Z)({value:i,journeySearchType:s},a),{},{onChange:l});return n.createElement(F.Z,{name:r},n.createElement($e,c))};var tt=s(25038),st=s(52480),at=s(82768),rt=s(10571),nt=s(91937),it=s(39908),ot=s(78361),lt=s(4234),ct=s(19133),dt=s(7739),ut=[dt.Ai,dt.gl,dt.jl,dt.tS,dt.Qp,dt.lU],pt=(e,t)=>e&&Object.keys(e).length?ot.ZP.errorButton:t?ot.ZP.openButton:ot.ZP.button;class ht extends n.Component{constructor(){super(...arguments),(0,v.Z)(this,"unmounted",!1),(0,v.Z)(this,"refNewPassengerPickerContainer",n.createRef()),(0,v.Z)(this,"state",{isOpen:!1,displayValidationOverlay:!1}),(0,v.Z)(this,"getPromoWarnings",(e=>!!e.filter((e=>e.code&&ut.includes(e.code))).length)),(0,v.Z)(this,"onToggle",(()=>{this.state.isOpen||this.props.onPassengerPickerOpened(),this.setState({isOpen:!this.state.isOpen}),this.props.triggerPassengerPickerCompletedAnalytics&&this.state.isOpen&&this.props.triggerPassengerPickerCompletedAnalytics()})),(0,v.Z)(this,"onClosePassengerOverlay",(()=>{this.setState({displayValidationOverlay:!1})})),(0,v.Z)(this,"onDismiss",((e,t)=>{var s=this.findDOMNode();s&&(s.contains(e.target)||s.isSameNode(e.target))||this.props.isUKDiscountCardsModalOpen||this.closeCardTypes(t)})),(0,v.Z)(this,"closeCardTypes",(e=>{var t;e?this.setState({displayValidationOverlay:!0}):this.setState({displayValidationOverlay:!1,isOpen:!1}),this.props.triggerPassengerPickerCompletedAnalytics&&this.props.triggerPassengerPickerCompletedAnalytics();var{formValues:s,setPromoCodeEnteredFlag:a}=this.props;a(!(null==s||null===(t=s.ukVoucherInput)||void 0===t||!t.length))}))}findDOMNode(){return this.unmounted?void 0:rt.findDOMNode(this)}componentDidMount(){this.setState({isOpen:!!(this.props.forcePassengerPickerOpen&&this.props.forcePassengerPickerOpen.forceOpen||this.getPromoWarnings(this.props.warnings||[]))}),this.props.disabledPromoText&&this.props.resetPromoField()}componentWillUnmount(){this.unmounted=!0}render(){var{isOpen:e,displayValidationOverlay:t}=this.state,{portal:s,passengers:a,cardTypes:r=[],errors:i,availableCardTypes:o,forcePassengerPickerOpen:c,disableCoach:d,sortedDiscountCardOptions:u,locale:p,locations:m,from:g,to:v,discountCardsLoadStatus:y,enableNewUkPassengerPicker:f,launchUKDiscountCardModal:S,enableUkVouchers:C,formValues:P,disabledPromoText:D=!1,intl:k,warnings:T}=this.props,{adults:F,children:I}=(0,h.V6)(a),L=f?(0,nt.F)(a,r):void 0,x=r.filter((e=>e.id)).length,O=()=>this.closeCardTypes(L),A=i&&Object.keys(i).length,M=this.refNewPassengerPickerContainer&&this.refNewPassengerPickerContainer.current;e&&M&&(e=>{var{bottom:t}=e.getBoundingClientRect(),s=t+25;if(s>window.innerHeight){var a=window.scrollY+(s-window.innerHeight);window.scrollTo({top:a,behavior:"smooth"})}})(M);var V=null==P?void 0:P.ukVoucherInput,j=!(!T||!T.length),_=f?ot.ZP.newUkPassengerPickerWrapper:(0,R.isTrainlinePortal)(s)?ot.ZP.dropdownContainer:j?ot.ZP.dropdownContainerWithErrors:ot.ZP.dropdownContainer;return n.createElement("div",{className:(0,E.css)(ot.ZP.root)},n.createElement(b.ZP,{id:"passenger-summary-btn",styleSheet:pt(i,e),onClick:this.onToggle,ariaHaspopup:!0,ariaExpanded:e,"aria-live":"assertive",testId:"passenger-summary-btn-open",ariaLabel:(0,De.t)({adults:F,children:I,intl:k,isEUSearch:!1,isAria:!0,noOfRailcards:x})},n.createElement(De.Z,{adults:F,children:I}),n.createElement("div",null,1===r.filter((e=>e.id)).length&&y===R.LoadStatus.SUCCESS?C?n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.passengerPicker.railcards.selectLabel.promo",values:{promoCode:null==V?void 0:V.length,railcardName:(0,at.ETc)([r[0].id,"name"],o)}}):(0,at.ETc)([r[0].id,"name"],o):n.createElement(Ae,{railcards:x,isEuropeExperience:!1,locale:p,locations:m,from:g,to:v,enableUkVouchers:C,promoCode:null==V?void 0:V.length})),n.createElement("div",{className:(0,E.css)(ot.ZP.chevronWrapper)},n.createElement(Z.Z,{className:(0,E.css)(ot.ZP.chevron)}))),L&&n.createElement(ct.Z,{messageId:L.messageId,titleId:L.titleId,displayValidationAlert:t,onClose:this.onClosePassengerOverlay}),e?n.createElement(N.Z,{onDismiss:e=>{A||this.onDismiss(e,L)}},n.createElement(Pe.Z,null,n.createElement(w.Z,{styleSheet:_},f?n.createElement("div",{ref:this.refNewPassengerPickerContainer},n.createElement(it.Z,{adults:F,children:I,discountCards:u,launchUKDiscountCardModal:S}),n.createElement(b.KM,{onClick:O,styleSheet:ot.ZP.doneButton,depot:!0,testId:"passenger-summary-btn-done",size:"m"},n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.passengerPicker.doneLabel"}))):n.createElement(lt.ZP,{portal:s,adultCount:F,childCount:I,cardTypes:r,sortedDiscountCardOptions:u,errors:i,disabledPromoText:D,onDone:O,disableCoach:d,forceShowCallout:c&&c.openCallout,discountCardsLoadStatus:y,enableUkVouchers:C})))):n.createElement(oe.Z,{error:i&&Object.keys(i).map((e=>i[e])),testId:"railcards-exceed-passengers"}))}}var mt=(e,t,s)=>e.formatMessage({id:t})||s,gt=e=>e&&f()(e.date).hours(Number(e.hours)).minutes(Number(e.minutes)+x.Bb).format(),vt=e=>{var{updatingLists:t}=e;return Object.keys(t||{}).reduce(((e,s)=>e||t[s]),!1)},Et=[R.JourneySearchFormDirection.OUTBOUND,R.JourneySearchFormDirection.INBOUND],yt=e=>{var t,s,a=!(null!==(t=e.formValues)&&void 0!==t&&t.from.code||null!==(s=e.formValues)&&void 0!==s&&s.to.code),r=e.intl&&e.intl.locale&&"en"!==e.intl.locale.split("-")[0].toLowerCase()||!1;return e.hasEuropeExperience||a&&r};class ft extends n.Component{static getDerivedStateFromProps(e,t){var s=vt(e),a=yt(e),r=t.submitting&&t.waitingForUpdatedLists||e.submitting||!1,n=t.submitting&&t.waitingForUpdatedLists||e.submitting||!1;return(0,o.Z)((0,o.Z)({},t),{},{isEuropeExperience:a,waitingForUpdatedLists:s,submitting:r,showSpinner:n})}constructor(e){var t;super(e),t=this,(0,v.Z)(this,"portal",void 0),(0,v.Z)(this,"viaAvoidRef",void 0),(0,v.Z)(this,"viaAvoidFieldRef",void 0),(0,v.Z)(this,"viaAvoidLabelButtonRef",void 0),(0,v.Z)(this,"journeyTypeRef",void 0),(0,v.Z)(this,"viaAvoidInputRef",void 0),(0,v.Z)(this,"spinnerTimeout",void 0),(0,v.Z)(this,"updatingListsPromise",void 0),(0,v.Z)(this,"updatingListsResolver",void 0),(0,v.Z)(this,"saveViaAvoidRef",(e=>this.viaAvoidRef=e)),(0,v.Z)(this,"saveViaAvoidInputRef",(e=>this.viaAvoidFieldRef=e)),(0,v.Z)(this,"saveViaAvoidLabelButtonRef",(e=>this.viaAvoidLabelButtonRef=e)),(0,v.Z)(this,"saveJourneyTypeRef",(e=>this.journeyTypeRef=e)),(0,v.Z)(this,"moveFocusAfterStation",((e,t)=>{"ShiftTab"!==t&&(this.viaAvoidRef&&this.viaAvoidRef.isExpanded()&&this.viaAvoidFieldRef&&this.viaAvoidFieldRef!==document.activeElement?this.viaAvoidFieldRef.focus():this.viaAvoidRef&&!this.viaAvoidRef.isExpanded()&&this.viaAvoidLabelButtonRef?this.viaAvoidLabelButtonRef.focus():this.journeyTypeRef&&this.journeyTypeRef.focus())})),(0,v.Z)(this,"moveFocusAfterViaAvoidStation",(e=>{"ShiftTab"!==e&&this.journeyTypeRef&&this.journeyTypeRef.focus()})),(0,v.Z)(this,"onOutboundNextOrSameDayClick",(e=>{var t,{outbound:s,inbound:a}=this.props.formValues,r=(t=a)&&t.date&&t.hours&&t.minutes?f()(t.date).hours(parseInt(t.hours,10)).minutes(parseInt(t.minutes,10)):null;if(r&&r.isBefore(e)&&this.props.change){var n=f()(e).hours(parseInt(s.hours,10)).minutes(parseInt(s.minutes,10)+x.Bb);this.props.change("inbound",(0,x.ym)(n,a&&a.dateType))}})),(0,v.Z)(this,"submitForm",(function(){var e,s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{shouldDelaySubmission:a,submitForm:r,formValues:{euFlowPassengers:n,directSearch:i},locations:o,isGuest:l,isRecognisedUser:c,from:d,to:u,sendTracking:h,portal:m}=t.props,g=i||!1;!(0,Ye.pN)({locations:o,isGuest:l,isRecognisedUser:c,originId:null==d?void 0:d.id,destinationId:null==u?void 0:u.id})&&n.length&&(0,k.vv)(n,t.props.dispatch),t.spinnerTimeout=setTimeout((()=>{t.props.isFormValid&&t.setState({showSpinner:!0})}),250),m===R.Portal.TRAINLINE&&(h((0,p.k1)({coreProperties:{},category:"direct trains checkbox",action:g?"direct trains checked":"direct trains unchecked",label:"direct trains checkbox"})),"undefined"!=typeof window&&window.newrelic&&window.newrelic.addPageAction("direct trains checkbox",{checked:g})),(e=s||a?500:0,new Promise((t=>setTimeout(t,e)))).then((()=>{r()}))})),(0,v.Z)(this,"handleSubmitClick",(()=>{this.state.showSpinner||(this.setState({submitting:!0}),this.updatingListsPromise?this.setState({showSpinner:!0}):this.submitForm())})),(0,v.Z)(this,"getSubmitLabel",((e,t)=>e?n.createElement(l.FormattedMessage,{id:"page.journeySearchForm.seasonTickets.findSeasonTickets"}):t)),(0,v.Z)(this,"onSubmit",(e=>{e.preventDefault()})),this.state={submitting:!1,isMobileDevice:!1,showSpinner:!1,waitingForUpdatedLists:!1,isEuropeExperience:yt(this.props),pageLoaded:!1},this.pageLoad=this.pageLoad.bind(this)}componentDidUpdate(e){var{formValues:t,change:s,fetchRailCards:a,passengerPickerErrors:r,onModalOpenClose:n=(()=>{})}=this.props,i=vt(this.props),{resetPassenger:o,resetRailCards:l}=e;!this.state.waitingForUpdatedLists&&i?this.updatingListsPromise=new Promise(((e,t)=>{this.updatingListsResolver={resolve:e,reject:t}})):this.state.waitingForUpdatedLists&&!i&&this.updatingListsResolver&&(this.updatingListsResolver.resolve(),delete this.updatingListsResolver,delete this.updatingListsPromise);var c=this.props.formValues.passengers.length>1||1===this.props.formValues.passengers.length&&!(0,fe.mS)(this.props.formValues.passengers[0]),d=yt(this.props);((0,k.Fu)(t)&&c&&d&&(o(),l()),"seasons"===t.journeySearchType&&this.state.isEuropeExperience&&s&&s("journeySearchType",I.ki.SINGLE),(e=>{var{discountCardsLoadStatus:t,formValues:s}=e,a=yt(e),r=s.euFlowPassengers.map((e=>e.discountCards.length)).reduce(((e,t)=>e+t),0);return a&&r&&t===R.LoadStatus.UNDEFINED})(this.props)&&a&&a(),e.passengerPickerErrors!==r)&&n(!!(r&&Object.keys(r).length))}componentWillUnmount(){clearTimeout(this.spinnerTimeout),this.updatingListsResolver&&(this.updatingListsResolver.reject(),delete this.updatingListsResolver,delete this.updatingListsPromise),window.removeEventListener("load",this.pageLoad)}componentDidMount(){this.setState({isMobileDevice:Boolean("undefined"!=typeof navigator&&(0,D.tq)(navigator.userAgent))}),window.addEventListener("load",this.pageLoad)}pageLoad(){this.setState({pageLoaded:!0})}render(){var{portal:e,availableCardTypes:t,change:s,untouch:r,clearAsyncError:i,formValues:l,intl:c,passengerPickerErrors:d,euPassengerPickerErrors:u,suggestionsForFrom:p,suggestionsForTo:h,suggestionsForViaAvoid:m,swapStations:g,viaAvoidError:v,updateSuggestions:y,searchErrorKeys:f,updatingLists:D,forcePassengerPickerOpen:k,triggerPassengerPickerSelectedAnalytics:T,triggerPassengerPickerSavedPassengersAnalytics:F,triggerPassengerPickerCompletedAnalytics:L,savedPassengerCount:O,launchPRMDetailsModal:A,launchDiscountCardModal:M,removeInvalidDiscountCards:N,toggleDiscountCardEnabled:w,shouldBlockPassengerPickerDismiss:V,form:j,isGuest:_,isRecognisedUser:U,sortedUKDiscountCardOptions:B,warnings:W,onRequestOpenPassengerProfileModal:Y,onRequestOpenVoucherModal:z,popularStationsForFrom:K,popularStationsForTo:q,exploreEuropeStationsForFrom:G,exploreEuropeStationsForTo:H,locale:Q,locations:J,from:$,to:X,onMeasurePerformance:ee,isPassengerProfileModalOpen:te,isVoucherModalOpen:se,isSearchResultsPage:ae,onPassengerPickerOpened:re,discountCardsLoadStatus:ne,enableNewUkPassengerPicker:ce,isUKDiscountCardsModalOpen:de,launchUKDiscountCardModal:ue,isDirectSearchEnabled:pe,isRailcardRecommendBannerEnabled:he,prmEnabled:me,submitButtonLabel:ge,setPromoCodeEnteredFlag:ve,enableUkVouchers:fe,disabledPromoText:be=!1,resetPromoField:Ce,enableSeasonsSearch:Pe,isOpenReturnChangesForMWebEnabled:Ze}=this.props,{journeySearchType:Re,outbound:De,passengers:ke,euFlowPassengers:Te,ukFlowCardTypes:Fe,viaAvoidStation:Ie,viaAvoidType:Le}=l,xe=yt(this.props),Oe=n.createElement(le.ZP,{focusOnMount:this.props.isInsideModal,suggestionsForFrom:p,suggestionsForTo:h,fromPlaceholder:mt(c,"page.journeySearchForm.from.placeholder","Enter origin station..."),toPlaceholder:mt(c,"page.journeySearchForm.to.placeholder","Enter destination station..."),swapStations:g,formValues:l,onToInputConfirmKey:this.moveFocusAfterStation,updateSuggestions:y,updatingLists:D,form:j,popularStationsForFrom:K,popularStationsForTo:q,exploreEuropeStationsForFrom:G,exploreEuropeStationsForTo:H,onMeasurePerformance:ee,intl:c,onSuggestionSelected:this.props.onSuggestionSelected,portal:e}),Ae=n.createElement(ye.ZP,{avoidLabel:mt(c,"page.journeySearchForm.viaAvoid.avoidLabel","Avoid"),change:s,clearAsyncError:i,defaultLabel:mt(c,"page.journeySearchForm.viaAvoid.defaultSelectLabel","Select..."),error:v,placeholder:mt(c,"page.journeySearchForm.viaAvoid.placeholder","Enter station..."),saveViaAvoidLabelButtonRef:this.saveViaAvoidLabelButtonRef,saveInputRef:this.saveViaAvoidInputRef,saveRef:this.saveViaAvoidRef,suggestions:m,viaLabel:mt(c,"page.journeySearchForm.viaAvoid.viaLabel","Go via"),forceShowForm:Boolean(Le&&Ie&&Ie.name),updateSuggestions:y,updating:D.viaAvoid,onStationConfirm:this.moveFocusAfterViaAvoidStation,hasEuropeExperience:xe,untouch:r,viaAvoidType:Le,viaAvoidStationName:Le&&Ie&&Ie.name}),Me=this.state.isEuropeExperience?n.createElement(Ge,{prmEnabled:me,forcePassengerPickerOpen:k,onPassengerPickerOpened:re,onRequestOpenPassengerProfileModal:Y,onRequestOpenVoucherModal:z,isGuest:_,isRecognisedUser:U,availableCardTypes:t,passengers:Te,errors:u,triggerPassengerPickerSelectedAnalytics:T,triggerPassengerPickerSavedPassengersAnalytics:F,savedPassengerCount:O,launchPRMDetailsModal:A,launchDiscountCardModal:M,removeInvalidDiscountCards:N,toggleDiscountCardEnabled:w,shouldBlockPassengerPickerDismiss:V,voucherCount:l.voucherInput?1:0,locale:Q,locations:J,from:$,to:X,isPassengerProfileModalOpen:te,isRailcardRecommendBannerEnabled:he,isVoucherModalOpen:se,discountCardsLoadStatus:ne,onChangePassengerSelection:e=>{var t=l.voucherPassengerSelections;!(t&&e.find((e=>e.value===t)))&&s&&e&&e[0]&&s("voucherPassengerSelections",e[0].value)}}):n.createElement(ht,{portal:e,passengers:ke,onPassengerPickerOpened:re,cardTypes:Fe,availableCardTypes:t,sortedDiscountCardOptions:B,errors:d,triggerPassengerPickerSelectedAnalytics:T,triggerPassengerPickerCompletedAnalytics:L,forcePassengerPickerOpen:k,locale:Q,locations:J,from:$,to:X,discountCardsLoadStatus:ne,enableNewUkPassengerPicker:ce,launchUKDiscountCardModal:ue,isUKDiscountCardsModalOpen:de,formValues:l,setPromoCodeEnteredFlag:ve,enableUkVouchers:fe,disabledPromoText:be,resetPromoField:Ce,warnings:W,intl:c}),Ne={locale:c.locale,afterLabel:mt(c,"page.journeySearchForm.dateTimePicker.afterLabel","Departing"),beforeLabel:mt(c,"page.journeySearchForm.dateTimePicker.beforeLabel","Arriving"),startDateTime:(0,x.uy)(!0,!1).format(),onNextOrSameDayClick:this.onOutboundNextOrSameDayClick,isSubmitting:this.state.submitting,journeySearchType:Re,hasEuropeExperience:xe},we={locale:c.locale,startDateTime:(0,x.uy)(!0,!1).format(),journeySearchType:Re,hasEuropeExperience:xe},Ve={startDateTime:gt(De),disabled:"return"!==Re,onDisabledClick:()=>{s&&(s("journeySearchType",I.ki.RETURN),Ze&&s("openReturnType",void 0))},journeySearchTypeChange:s},je="seasons"===l.journeySearchType&&!this.state.isEuropeExperience;return n.createElement("form",{className:(0,E.css)(st.ZP.root),onSubmit:this.onSubmit,autoComplete:"off","data-test":"ExtendedSearch"},n.createElement(oe.Z,{error:f,useConnector:!1}),n.createElement(tt.ZP,{warnings:W}),Oe,Ae,n.createElement(S.Z,{component:Ee,name:"journeySearchType",saveRef:this.saveJourneyTypeRef,hasEuropeExperience:xe,isSearchResultsPage:ae,enableSeasonsSearch:Pe,isOpenReturnChangesForMWebEnabled:Ze,change:s}),je?n.createElement("div",{className:(0,E.css)(st.ZP.seasonsDatePickerWrapper)},n.createElement(S.Z,(0,a.Z)({},we,{component:et,name:"seasons",testId:"seasons-datepicker",title:"page.journeySearchForm.".concat("name",".title")}))):n.createElement(n.Fragment,null,n.createElement("div",{className:(0,E.css)(st.ZP.dateTimePickerSection)},Et.map(((e,t)=>{var s=e===R.JourneySearchFormDirection.INBOUND?(0,o.Z)((0,o.Z)({},Ne),Ve):Ne;return n.createElement(S.Z,(0,a.Z)({},s,{component:ie,name:e,key:t,testId:"".concat(e,"-datepicker"),title:"page.journeySearchForm.".concat(e,".title"),sameDayLabel:"page.journeySearchForm.".concat(e,".sameDayLabel"),nextDayLabel:"page.journeySearchForm.".concat(e,".nextDayLabel"),sameDayAriaLabel:"page.journeySearchForm.".concat(e,".sameDayLabel.aria"),nextDayAriaLabel:"page.journeySearchForm.".concat(e,".nextDayLabel.aria")}))}))),n.createElement(C.Z,{styleSheet:st.ZP.horizontalRule}),Me),pe&&!je&&n.createElement("div",null,n.createElement(S.Z,{id:"directSearch",name:"directSearch",component:Se.Z,type:"checkbox",intl:c,native:!0})),n.createElement("div",{className:(0,E.css)(st.ZP.submitButtonContainer)},n.createElement(b.KM,{type:"submit",styleSheet:[st.ZP.submitButton,this.state.pageLoaded&&st.ZP.submitButtonAnimation],testId:"submit-journey-search-button",onClick:this.handleSubmitClick},this.getSubmitLabel(je,ge),n.createElement("div",{className:(0,E.css)(st.ZP.submitButtonChevronWrapper)},this.state.showSpinner?n.createElement(P.Z,{size:17,borderWidth:3}):n.createElement(Z.Z,{className:(0,E.css)(st.ZP.submitButtonChevron)})))))}}const St=ft;var bt,Ct=s(51282),Pt=s(79423),Zt=s(15685),Rt=s(28394),Dt=e=>{var t=(0,Ct.GE)(e);return t&&(t.outbound===L.ZA.outbound.past||t.inbound===L.ZA.inbound.past)},kt=(e,t)=>{var s=(0,Rt.c)(e,t),a=s&&s!==R.Portal.TRAINLINE,r=a?(0,Zt.YK)(e,t):(0,Zt.qU)(e,t),n=a?(0,Zt.mk)(e,t):(0,Zt.ZL)(e,t);return{formValues:(0,Ct.gH)(e),submitErrors:(0,Ct.nB)(e),formMeta:(0,Ct.tq)(e),suggestionsForTo:(0,Zt.nQ)(e,t),suggestionsForFrom:(0,Zt.Jz)(e,t),suggestionsForViaAvoid:(0,Zt.El)(e,t),passengerPickerErrors:(0,Ct.I6)(e),euPassengerPickerErrors:(0,Ct.Ju)(e),shouldDelaySubmission:Dt(e),viaAvoidError:(0,Ct.VT)(e),searchErrorKeys:(0,Ct.zL)(e,t),updatingLists:(0,Ct.mN)(e),isFormValid:(0,Ct.gT)(e),hasEuropeExperience:(0,Ct.NP)(e,t),availableCardTypes:(0,Ct.fd)(e,t),sortedUKDiscountCardOptions:(0,Ct.En)(e,t),isGuest:Boolean(t.isLoggedInUserExperienceReady)&&!(0,Ct.L6)(e),popularStationsForFrom:r,popularStationsForTo:n,exploreEuropeStationsForFrom:(0,Zt.SE)(e,t),exploreEuropeStationsForTo:(0,Zt.m)(e,t),inboundError:(0,Ct.YS)(e),outboundError:(0,Ct.PY)(e),from:(0,Ct.Ks)(e,t),to:(0,Ct.XS)(e,t),prmEnabled:(0,Ct.BN)(e,t),initialValues:(0,Re.q3)(),directSearch:(0,Ct.sd)(e)}},Tt=(e,t)=>({submitForm:()=>{t.submitForm&&t.submitForm(),e((0,d.Ps)(I.Th))},onPassengerPickerOpened:()=>{e((0,Pt.Je)())},swapStations:t=>{var{from:s,to:a}=t;e((0,d.m)(I.Th,"from",a)),e((0,d.m)(I.Th,"to",s)),e((0,d.m6)(I.Th)),e((0,d.cS)(I.Th,(0,L.qF)(g.P.SYNC,(0,o.Z)((0,o.Z)({},t),{},{to:s,from:a}))))},updateSuggestions:(t,s)=>{e((0,Pt.ue)(t,!0,I.Th)),e((0,Pt.gD)({stationField:t,query:s,formName:I.Th}))},resetPassenger:()=>{var t=[(0,h.Q9)().ADULT_DOB];e((0,d.m)(I.Th,"passengers",t))},resetRailCards:()=>{e((0,d.m)(I.Th,"ukFlowCardTypes",[]))},setPromoCodeEnteredFlag:t=>{e({type:"promoCode/PROMO_CODE_ENTERED",payload:t})},resetPromoField:()=>{e((0,d.m)(I.Th,"ukVoucherInput",""))}});const Ft=(bt=St,(0,c.compose)((0,i.connect)(kt,Tt),l.injectIntl,(0,u.Z)(m.Z),p.v8)(bt));var It=s(21168),Lt=s(68760),xt=s(62331),Ot=s(19408),At=s(12592),Mt=s(92490),Nt=s(5202),wt=s(94762),Vt=s(30272),jt=s(97340),_t=s(63495),Ut=s(54641),Bt=s(73584),Wt=s(4794),Yt=s(67903),zt=s(88589),Kt=s(83447),qt=s(33132),Gt=s(983),Ht=s(29433),Qt=s(26532),Jt=s(97866),$t=s(40939),Xt=s(51059),es=s(97819),ts=s(89034),ss=s(44544),as=s(18332),rs=s(48977),ns=s(87654),is=s(31521),os=s(45499),ls=s(83504),cs=s(12720),ds=s(75853),us=s(78524),ps=s(33695);const hs=(0,i.connect)((e=>{var t=(0,es.zZ)((0,jt.dT)(e)),s=(0,Jt.c7)(e)===R.Portal.TRAINLINE;return{availableCardTypes:(0,xt.ic)(e),isLoggedInUserExperienceReady:(0,Ht.yo)(e),locations:(0,Mt.Yu)(e),recentLocations:(0,Vt.eA)(e),suggestionLocationIndexes:(0,_t.jZ)(e),shouldBlockPassengerPickerDismiss:Boolean((0,zt.bE)(e).length||(0,zt.JR)(e).length),disableCoach:(0,Jt.zE)(e),locale:(0,$t.fN)(e),enableG30Vouchers:(0,Ht.Rt)(e),popularLocations:(0,Nt.hJ)(e),popularLocationsToc:(0,wt.Bq)(e),exploreEuropeLocations:s&&(0,$t.BX)(e)?(0,At.qQ)(e):[],isRecognisedUser:(0,Lt.yW)(e),savedPassengerCount:t.length,lastNavigation:(0,Wt.RP)(e),isPassengerProfileModalOpen:(0,zt.uv)(e,It.e.PASSENGER_PROFILE),isVoucherModalOpen:(0,zt.uv)(e,It.e.VOUCHER),isSearchResultsPage:(0,ls.gZ)(e),discountCardsLoadStatus:(0,Ut.P0)(e),homepageType:(0,Yt.cd)(e),enableNewUkPassengerPicker:(0,Ot.eB)(e,ps.zA.ENABLE_NEW_UK_PASSENGER_PICKER),isRailcardRecommendBannerEnabled:(0,os.du)(e),isUKDiscountCardsModalOpen:(0,zt.uv)(e,It.e.UK_DISCOUNT_CARD),isDirectSearchEnabled:(0,Jt.x8)(e),enableUkVouchers:(0,Ht.Lq)(e),enableSeasonsSearch:(0,Ht.as)(e),disabledPromoText:(0,is.ck)(e),isOpenReturnChangesForMWebEnabled:(0,ss.EX)(e)&&(0,Xt.In)(e)}}),(e=>({onRequestOpenPassengerProfileModal:t=>{e((0,ts.Ll)({type:It.e.PASSENGER_PROFILE,params:{passengerId:t}}))},onRequestOpenVoucherModal:()=>{e((0,ts.Ll)({type:It.e.VOUCHER,params:{}}))},deleteVoucher:()=>e((0,Bt.Qw)()),triggerPassengerPickerSavedPassengersAnalytics:t=>e((0,Gt.ju)({savedPassengerCount:t})),launchPRMDetailsModal:t=>{e((0,Kt.fE)(t))},launchDiscountCardModal:t=>{e((0,Qt._w)(t))},launchUKDiscountCardModal:(t,s)=>{e((0,ts.Ll)({type:It.e.UK_DISCOUNT_CARD,params:{discountCards:t,onSelect:s}}))},removeInvalidDiscountCards:(t,s,a)=>r=>{e((0,Qt.PT)({userIndex:t,passenger:s,cards:a,newPassengerType:r}))},toggleDiscountCardEnabled:t=>{var{userIndex:s,cardId:a}=t;e((0,Qt.hG)({userIndex:s,cardId:a}))},onSuggestionSelected:t=>{e((0,qt.UO)(t))},fetchRailCards:()=>e((0,xt.jb)())})))((e=>{var{portal:t}=(0,ds.x)(),{experimentsDict:s}=(0,as.zM)(["experimentsDict"]),{isUniversalDirectSearchEnabledForLeisure:i,isDirectSearchEnabled:o,isDirectSearchLimitedByMarket:l}=(0,ns.Z)();i&&(0,rs.QH)(s,[ps.zA.ENABLE_DIRECT_SEARCH_REQUEST]);return n.createElement(Ft,(0,a.Z)({portal:t},e,{isDirectSearchEnabled:o&&!l,onMeasurePerformance:()=>{e.isInsideModal||setTimeout((()=>{(0,r.mark)(us.he),(0,cs.dx)(us.n,e.homepageType)}))}}))}))}}]);